<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WhatsAppBot</title>
  <style>
    * {
      margin: 0; padding: 0; box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #111b21;
      color: #e9edef;
      display: flex;
      height: 100vh;
    }
    .sidebar {
      width: 350px;
      background-color: #202c33;
      display: flex;
      flex-direction: column;
      border-right: 1px solid #2a3942;
      position: relative;
    }
    .sidebar-header {
      background-color: #2a3942;
      border-bottom: 1px solid #3b4a54;
      padding: 16px;
      display: flex;
      align-items: center;
      position: relative;
    }
    .sidebar-title {
      font-size: 18px;
      font-weight: 600;
    }
    .menu-icon {
      font-size: 20px;
      cursor: pointer;
      margin-left: auto;
      color: #e9edef;
      user-select: none;
    }
    .dropdown-menu {
      position: absolute;
      top: 45px;
      left: 340px;
      background-color: #2a3942;
      border: 1px solid #3b4a54;
      border-radius: 8px;
      display: none;
      flex-direction: column;
      min-width: 140px;
      z-index: 100;
    }
    .dropdown-item {
      padding: 10px 16px;
      color: #e9edef;
      cursor: pointer;
      border-bottom: 1px solid #3b4a54;
    }
    .dropdown-item:last-child {
      border-bottom: none;
    }
    .dropdown-item:hover {
      background-color: #3b4a54;
    }
    .search-bar {
      background-color: #2a3942;
      border-bottom: 1px solid #3b4a54;
      padding: 16px;
    }
    .search-input {
      width: 100%;
      padding: 8px 12px;
      border-radius: 8px;
      border: none;
      background-color: #3b4a54;
      color: #e9edef;
    }
    .search-input::placeholder {
      color: #8696a0;
    }
    .chat-list {
      flex: 1;
      overflow-y: auto;
    }
    .chat-item {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #2a3942;
      cursor: pointer;
    }
    .chat-item:hover {
      background-color: #2a3942;
    }
    .chat-avatar {
      width: 40px;
      height: 40px;
      background-color: #00a884;
      border-radius: 50%;
      display: flex;
      justify-content: center;
      align-items: center;
      color: white;
      font-weight: bold;
    }
    .chat-content {
      margin-left: 12px;
      flex: 1;
    }
    .chat-name {
      font-weight: 500;
      color: #e9edef;
    }
    .chat-message {
      color: #8696a0;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .main-content {
      flex: 1;
      background-color: #0b141a;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px;
    }
    .bot-title {
      font-size: 32px;
      font-weight: 300;
      margin-bottom: 20px;
    }
    .login-text {
      color: #8696a0;
      font-size: 16px;
      margin-bottom: 30px;
      text-align: center;
      max-width: 400px;
    }
    .qr-code {
      width: 200px;
      height: 200px;
      margin-bottom: 20px;
    }
    .status-text {
      font-size: 14px;
      color: #00a884;
      margin-top: 10px;
    }
    .logout-link {
      color: #00a884;
      font-size: 14px;
      cursor: pointer;
      transition: color 0.2s;
    }
    .logout-link:hover {
      text-decoration: underline;
      color: #1ed99c;
    }

    /* Modal background */
    .modal {
      display: none;
      position: fixed;
      z-index: 999;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background-color: rgba(0, 0, 0, 0.5); /* semi transparan */
      justify-content: center;
      align-items: center;
      font-family: sans-serif;
    }

    /* Modal box */
    .modal-content {
      background: #25c7a1;
      padding: 24px 32px;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.2);
      text-align: center;
      max-width: 90%;
      width: 350px;
    }

    /* Tombol */
    .modal-buttons {
      margin-top: 16px;
      display: flex;
      justify-content: center;
      gap: 12px;
    }

    .btn {
      padding: 10px 20px;
      font-weight: bold;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: background-color 0.2s;
    }

    .btn-confirm {
      background-color: #d9534f;
      color: white;
    }

    .btn-confirm:hover {
      background-color: #c9302c;
    }

    .btn-cancel {
      background-color: #f0f0f0;
      color: #333;
    }

    .btn-cancel:hover {
      background-color: #e0e0e0;
    }


  </style>
</head>
<body>
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">WhatsAppBot</div>
      <div class="menu-icon" id="menu-icon">â˜°</div>
      <div class="dropdown-menu" id="dropdown-menu">
        <div class="dropdown-item" id="send-item">ðŸ“¤ Pesan Baru</div>
        <div class="dropdown-item" id="logout-item">ðŸ”’ Logout</div>
      </div>
    </div>
    <div class="search-bar">
      <input type="text" class="search-input" placeholder="Cari atau mulai chat baru">
    </div>
    <div class="chat-list">
      <div class="chat-item">
        <div class="chat-avatar">C</div>
        <div class="chat-content">
          <div class="chat-name">Cynthia</div>
          <div class="chat-message">isinya!</div>
        </div>
      </div>
      <div class="chat-item">
        <div class="chat-avatar">+</div>
        <div class="chat-content">
          <div class="chat-name">+62 851-1754-5793</div>
          <div class="chat-message">ðŸ“ž iHo</div>
        </div>
      </div>
      <div class="chat-item">
        <div class="chat-avatar">R</div>
        <div class="chat-content">
          <div class="chat-name">RiskiGunawan</div>
          <div class="chat-message">ðŸ“± ðŸ“¤ ðŸ“§</div>
        </div>
      </div>
    </div>
  </div>

  <div class="main-content">
    <div class="bot-title">WhatsAppBot</div>
    <div class="login-text">Login via QR untuk menghubungkan akun WhatsApp kamu ke sistem bot</div>
    <div class="status-text" id="status-text">ðŸ”„ Menunggu QR codedd...</div>
  </div>
  
  <div id="logout-modal" class="modal">
    <div class="modal-content">
      <p>Apakah Anda yakin ingin logout?</p>
      <div class="modal-buttons">
        <button id="confirm-logout-btn" class="btn btn-confirm">Ya</button>
        <button id="cancel-logout-btn" class="btn btn-cancel">Batal</button>
      </div>
    </div>
  </div>

  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
  <script>
    const socket = io(); // otomatis connect ke host yang sama dengan frontend
    const qrContainer = document.getElementById("qr-container");
    const statusText = document.getElementById("status-text");
    let canvas = null;
    socket.on("ready", () => {
      if (canvas) {
        qrContainer.removeChild(canvas);
        canvas = null;
      }

      statusText.textContent = "âœ… WhatsApp terhubung!";
    });

    // === Dropdown logic ===
    const menuIcon = document.getElementById("menu-icon");
    const dropdownMenu = document.getElementById("dropdown-menu");
    const logoutItem = document.getElementById("logout-item");

    menuIcon.addEventListener("click", () => {
      dropdownMenu.style.display =
        dropdownMenu.style.display === "flex" ? "none" : "flex";
    });

    document.addEventListener("click", (e) => {
      if (
        !menuIcon.contains(e.target) &&
        !dropdownMenu.contains(e.target)
      ) {
        dropdownMenu.style.display = "none";
      }
    });

    // === Modal logic Logout ===
    const logoutModal = document.getElementById("logout-modal");
    const confirmLogoutBtn = document.getElementById("confirm-logout-btn");
    const cancelLogoutBtn = document.getElementById("cancel-logout-btn");

    logoutItem.addEventListener("click", () => {
      dropdownMenu.style.display = "none";
      logoutModal.style.display = "flex";
    });

    confirmLogoutBtn.addEventListener("click", () => {
  console.log("âœ… Tombol logout diklik");
      socket.emit("logout");
      statusText.textContent = "ðŸ”„ Menunggu QR code...";
      logoutModal.style.display = "none";
      setTimeout(() => {
        window.location.href = "index.html";
      }, 500);
    });

    cancelLogoutBtn.addEventListener("click", () => {
      logoutModal.style.display = "none";
    });
    // === Modal logic Logout End ===

  </script>
</body>
</html>